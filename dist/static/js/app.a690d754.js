(function(e){function t(t){for(var o,s,i=t[0],c=t[1],u=t[2],f=0,d=[];f<i.length;f++)s=i[f],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);l&&l(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var c=n[i];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0502":function(e,t,n){"use strict";var o=n("fac8"),r=n.n(o);r.a},"056e":function(e,t,n){e.exports=n.p+"static/img/lm.b4c5625e.jpeg"},"1d88":function(e,t,n){"use strict";var o=n("da69"),r=n.n(o);r.a},"462f":function(e,t,n){},"485c":function(e,t,n){e.exports=n.p+"static/img/wyh.7e1bba47.jpeg"},"4a97":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="4a97"},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("router-view")],1)},a=[],s=(n("96cf"),n("1da1")),i=n("5530"),c=n("eef7"),u=n.n(c),l=n("056e"),f=n.n(l),d=n("870b"),p=n.n(d),h=n("7eef"),m=n.n(h),g=n("485c"),v=n.n(g),b=n("ee4b"),w=n.n(b),x=n("81f9"),y=n.n(x),O=n("9993"),j=n.n(O),S=n("951a"),k=n.n(S),E=n("2f62"),L={name:"index",data:function(){return{heads:{roffer:u.a,lm:f.a,mxc:p.a,wyb:m.a,wyh:v.a,xj:w.a,zf:y.a,zyf:j.a,defaultImg:k.a}}},created:function(){},mounted:function(){this.getUserList()},methods:Object(i["a"])(Object(i["a"])({},Object(E["b"])({updateUserList:"common/updateUserList"})),{},{getUserList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.http.post("/api/userList");case 2:n=t.sent,e.updateUserList(n.data);case 4:case"end":return t.stop()}}),t)})))()}})},M=L,_=(n("0502"),n("2877")),N=Object(_["a"])(M,r,a,!1,null,"ec08508c",null),C=N.exports,R=(n("99af"),n("4160"),n("d3b7"),n("ac1f"),n("5319"),n("159b"),n("ddb0"),n("8c4f")),$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"})},T=[];n("a15b");function U(e){this.url=e,this.callback={},this.instance=null,this.init()}U.prototype.init=function(){var e=this,t=new WebSocket("ws://".concat(this.url));t.onmessage=function(t){var n=JSON.parse(t.data);e.callback[n.type]&&e.callback[n.type](n)},t.onclose=function(e){console.log("connect closed("+e.code+")")},t.onopen=function(e){console.log("连接成功！")},t.onerror=function(e){console.log("websocket连接失败！")},this.instance=t},U.prototype.addCallback=function(e,t){this.callback[e]=t},U.prototype.send=function(e){var t=this;this.instance.readyState==this.instance.OPEN?this.instance.send(JSON.stringify(e)):setTimeout((function(){t.send(e)}),1e3)},U.prototype.close=function(e){this.instance&&this.instance.close()};var I=U,P={name:"index",data:function(){return{user:null}},created:function(){var e=localStorage.getItem("token");if(e){var t=localStorage.getItem("user");t=JSON.parse(t),this.websocket=new I("125.64.98.29:8181/texas?uid=".concat(t._id)),this.websocket.addCallback("join",this.join),this.websocket.addCallback("out",this.out),this.websocket.send({type:"join",token:e})}else this.$router.push("/login")},mounted:function(){var e=this;window.addEventListener("beforeunload",(function(){var t=localStorage.getItem("token");e.websocket.send({type:"out",token:t})})),this.getData()},methods:{getData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.http.post("/api/userInfo");case 2:e.user=t.sent;case 3:case"end":return t.stop()}}),t)})))()},join:function(e){console.log("用户【".concat(e.user.username,"】加入了战斗"))},out:function(e){console.log("用户【".concat(e.user.username,"】退出了战斗"))}}},J=P,D=(n("1d88"),Object(_["a"])(J,$,T,!1,null,"794a92e8",null)),F=D.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"login",staticClass:"login"},[n("div",{staticClass:"form"},[n("img",{staticClass:"head",attrs:{src:e.heads[e.who]}}),n("div",{staticClass:"item"},[n("span",{staticClass:"iconfont icon-username"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"}],attrs:{type:"text"},domProps:{value:e.form.username},on:{blur:e.usernameBlur,input:function(t){t.target.composing||e.$set(e.form,"username",t.target.value)}}})]),n("div",{staticClass:"item"},[n("span",{staticClass:"iconfont icon-password"}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password,expression:"form.password"}],attrs:{type:"password"},domProps:{value:e.form.password},on:{input:function(t){t.target.composing||e.$set(e.form,"password",t.target.value)}}})]),n("div",{staticClass:"submit",on:{click:e.login}},[e._v("登录")])])])},B=[],H=(n("c740"),n("6aea")),A=n.n(H),q={name:"login",data:function(){return{heads:{roffer:u.a,lm:f.a,mxc:p.a,wyb:m.a,wyh:v.a,xj:w.a,zf:y.a,defaultImg:k.a},who:"defaultImg",form:{username:"",password:""}}},computed:Object(i["a"])({},Object(E["c"])({userList:"common/userList"})),mounted:function(){},methods:{usernameBlur:function(){var e=this;if(this.form.username){var t=this.userList.findIndex((function(t){return t.username===e.form.username}));-1!==t&&(this.who=this.userList[t].username)}},login:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(i["a"])({},e.form),n.password=A()(n.password),t.next=4,e.http.post("/api/login",n);case 4:o=t.sent,localStorage.setItem("user",JSON.stringify(o.data.user)),localStorage.setItem("token",o.data.token),e.$router.push("/home");case 8:case"end":return t.stop()}}),t)})))()}}},G=q,K=(n("c9b1"),Object(_["a"])(G,z,B,!1,null,"0583ab08",null)),W=K.exports,Y=n("f5d7");o["a"].use(R["a"]);var Q=[],V=[],X=n("4a97"),Z=n("65a9");Z.keys().forEach((function(e){"./index.js"!==e&&(V=V.concat(Z(e).routes))})),X.keys().forEach((function(e){var t=ne(e);Q.push({name:t,path:"/".concat(t),component:X(e).default})})),V=V.concat(Q);var ee=[{path:"/",redirect:"/home"},{path:"/login",component:W},{path:"/userAdd",component:Y["a"]},{path:"/home",component:F,children:V}],te=new R["a"]({mode:"history",routes:ee});function ne(e){return/^\S+\.vue$/.test(e)&&e.replace(/^\S+\/(\w+)\.vue$/,"$1")}te.beforeEach((function(e,t,n){n()}));var oe=te,re=n("b054"),ae=n.n(re),se={userList:[]},ie={userList:function(e){return e.userList}},ce={updateUserList:function(e,t){e.commit("updateUserList",t)}},ue={updateUserList:function(e,t){e.userList=t}},le={namespaced:!0,state:se,getters:ie,actions:ce,mutations:ue};o["a"].use(E["a"]);var fe=!1,de=new E["a"].Store({modules:{common:le},strict:fe,plugins:fe?[ae()()]:[]}),pe=n("b970"),he=(n("157a"),{SUCCESS:"200",TIMEOUT:5e3,ERRORS:{NOT_LOGIN:401}});n("4de4"),n("fb6a"),n("b680"),n("4d63"),n("25f0"),n("466d");function me(e,t){if(e){e=e instanceof Date?e:new Date(e);var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var o in t=(t||"yyyy-MM-dd hh:mm:ss").replace(/y+/i,e.getFullYear()),n)t=t.replace(new RegExp("("+o+")"),("0"+n[o]).slice(-2));return t}return""}function ge(e){return e=(""+e).replace(/(\d+)(\.)(\d+)/,"$1"),(""+e).replace(/(\d{1,3})(?=(\d{3})+(?:$|\D))/g,"$1,")}function ve(e){var t=new RegExp("(^|&|#)"+e+"=([^&]*)(&|$)","i"),n=window.location.href.replace(/(.*)(\?)(.*)/,"$3").match(t);return n?n[2]:""}function be(e){return e?JSON.parse(JSON.stringify(e)):{}}function we(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}function xe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}))}function ye(e,t){var n=[];for(var o in e)n.push(o);return t&&(n=n.join(",")),n}function Oe(e,t,n){var o=!1;function r(e){e[t]===n?o=!0:e.parentNode&&r(e.parentNode)}if(e.path){var a=e.path;a=a.filter((function(e){return e[t]===n})),o=a.length>0}else r(e.target||e.srcElement);return o}function je(e,t,n){var o;n=n||["B","K","M","G","TB"];while((o=n.shift())&&e>1024)e/=1024;return("B"===o?e:e.toFixed(t||2))+o}function Se(e){e.focus();var t=e.value.length;if(document.selection){var n=e.createTextRange();n.moveStart("character",t),n.collapse(),n.select()}else"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd&&(e.selectionStart=e.selectionEnd=t)}var ke={dateFormat:me,numberFormat:ge,getParamsFromUrl:ve,clone:be,randomId:we,uuid:xe,moveEnd:Se,getKeys:ye,isInTarget:Oe,formatFileSize:je},Ee=(n("c975"),n("bc3a")),Le=n.n(Ee),Me=n("4328"),_e=n.n(Me),Ne=n("d399");Le.a.defaults.timeout=he.TIMEOUT,Le.a.defaults.baseURL="/",Le.a.defaults.transformRequest=function(e){return _e.a.stringify(e)},Le.a.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t&&(e.headers["token"]=t),e}),(function(e){return Promise.reject(e.response)})),Le.a.interceptors.response.use((function(e){var t="string"===typeof e.data?JSON.parse(e.data):e.data;if(e.data=t,t.code!=he.SUCCESS){var n=e.data.msg;Object(Ne["a"])(n),t.code==he.ERRORS.NOT_LOGIN&&(location.href="/login");var o=new Error(n);throw o.data=t,o.response=e,o}return e.data}),(function(e){if(e.response&&e.response.data){var t=e.response.data;t="string"===typeof t?t:JSON.stringify(t),-1!==t.indexOf("code=401")&&(location.href="/login")}else e.message==="timeout of ".concat(he.TIMEOUT,"ms exceeded")&&Object(Ne["a"])("请求超时！");return Promise.reject(e)}));var Ce=Le.a;function Re(e){this.url=e,this.callback={},this.instance=null,this.init()}Re.prototype.init=function(){var e=this,t=new WebSocket("ws://".concat(this.url));t.onmessage=function(t){var n=JSON.parse(t.data);e.callback[n.type]&&e.callback[n.type](n.data)},t.onclose=function(e){console.log("connect closed("+e.code+")")},t.onopen=function(e){console.log("连接成功！")},t.onerror=function(e){console.log("websocket连接失败！")},this.instance=t},Re.prototype.addCallback=function(e,t){this.callback[e]=t},Re.prototype.send=function(e){var t=this;this.instance.readyState==this.instance.OPEN?this.instance.send(JSON.stringify(e)):setTimeout((function(){t.send(e)}),1e3)},Re.prototype.close=function(e){this.instance&&this.instance.close()};var $e=Re,Te=(n("b0c0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"more",style:{height:e.baseHeight}},[n("div",[e._t("default")],2)]),e.show?n("div",{staticClass:"show-more"},[n("span",{staticClass:"toggle",class:{bottom:this.showMore},on:{click:e.toggleShowMore}})]):e._e()])}),Ue=[],Ie={name:"more",props:{height:{type:String,default:"5.4rem"},show:{type:Boolean,default:!0}},data:function(){return{showMore:!1,baseHeight:""}},mounted:function(){this.baseHeight=this.height,this.showMore=this.show},methods:{toggleShowMore:function(){this.showMore=!this.showMore,this.baseHeight="auto"===this.baseHeight?this.height:"auto"}}},Pe=Ie,Je=(n("e807"),Object(_["a"])(Pe,Te,Ue,!1,null,"7e98d868",null)),De=Je.exports,Fe=[De],ze={install:function(e){Fe.forEach((function(t){e.component(t.name,t)}))}},Be={ellipsis:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=new RegExp("(.{".concat(t,"})(.*)"));return e.replace(n,"$1...")},fileEllipsis:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=new RegExp("(.{".concat(t,"})(.*)(.{").concat(n,"})(\\..*)$"));return e.replace(o,"$1...$3$4")}},He={install:function(e){for(var t in Be)e.filter(t,Be[t])}},Ae=(n("a342"),{constant:he,utils:ke,http:Ce,socket:$e}),qe={install:function(e){if(this.installed)return!0;for(var t in e.use(pe["a"]),e.use(ze),e.use(He),e.config.productionTip=!1,Ae)e.prototype[t]=Ae[t]}};o["a"].use(qe),new o["a"]({store:de,router:oe,render:function(e){return e(C)}}).$mount("#app")},"65a9":function(e,t,n){var o={"./user/index.js":"f96f"};function r(e){var t=a(e);return n(t)}function a(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=a,e.exports=r,r.id="65a9"},"7eef":function(e,t,n){e.exports=n.p+"static/img/wyb.dcc9f2fa.jpeg"},"81f9":function(e,t,n){e.exports=n.p+"static/img/zf.dcd18ab4.jpeg"},"870b":function(e,t,n){e.exports=n.p+"static/img/mxc.8db74ca3.jpeg"},"951a":function(e,t,n){e.exports=n.p+"static/img/default.03694255.jpg"},9993:function(e,t,n){e.exports=n.p+"static/img/zyf.f821e822.jpg"},a342:function(e,t,n){},c9b1:function(e,t,n){"use strict";var o=n("462f"),r=n.n(o);r.a},da69:function(e,t,n){},e01f:function(e,t,n){},e807:function(e,t,n){"use strict";var o=n("e01f"),r=n.n(o);r.a},ee4b:function(e,t,n){e.exports=n.p+"static/img/xj.05a6882b.jpeg"},eef7:function(e,t,n){e.exports=n.p+"static/img/roffer.b73e1747.jpeg"},f5d7:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("van-uploader",{attrs:{"after-read":e.afterRead},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}}),e.fileList.length?n("img",{attrs:{src:e.fileList[0].url}}):e._e()],1)},r=[],a={name:"userAdd",data:function(){return{fileList:[]}},mounted:function(){},methods:{afterRead:function(e){var t=this;e.status="uploading",e.message="上传中...";var n=new FormData;n.append("file",e.file);var o={"Content-Type":"multipart/form-data"};this.http.post("/api/upload",n,{headers:o,transformRequest:[function(e){return e}]}).then((function(n){console.log(n),e.status="success",e.message="上传成功",e.url=n.data.url,t.fileList.push(e)})).catch((function(t){console.log(t),e.status="failed",e.message="上传失败"}))}}},s=a,i=n("2877"),c=Object(i["a"])(s,o,r,!1,null,"28024d8b",null);t["a"]=c.exports},f96f:function(e,t,n){"use strict";n.r(t),n.d(t,"routes",(function(){return r}));var o=n("f5d7"),r=[{path:"/userAdd",name:"userAdd",component:o["a"]}]},fac8:function(e,t,n){}});